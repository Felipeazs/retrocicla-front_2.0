<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<!--Bootstrap iconos-->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" />
		<!--FontAwesome-->
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
			integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		/>
		<!--Flickity gallery-->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flickity/1.0.0/flickity.css" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/flickity/1.0.0/flickity.pkgd.js"></script>
		<!--JQuery-->
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
			integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		></script>
		<!--Assets-->
		<script src="js/scripts.js"></script>
		<link rel="stylesheet" href="css/flickity.css" />
		<link rel="stylesheet" href="css/style.css" />
		<title>Inicio</title>
	</head>
	<body>
		<!-- Header -->

		<header>
			<div class="email">
				<div><i class="bi bi-envelope"></i></div>
				<p>retrocicla@gmail.com</p>
			</div>
			<div class="upcycling">
				<p>Revoluciona la Industria de la Moda</p>
			</div>
			<div class="icons">
				<i class="bi bi-whatsapp pe-3"></i>
				<i class="bi bi-instagram pe-3"></i>
				<i class="bi bi-facebook"></i>
			</div>
		</header>

		<!--Navigation-->

		<nav>
			<img src="img/logo-menu.png" alt="logo" />

			<!--Menú-->

			<div class="navigation">
				<div class="menu">
					<div class="barras">
						<button id="btn_barras"><i class="fa-solid fa-bars"></i></button>
					</div>
					<div class="contenido" id="contenido">
						<ul>
							<li class="nav-item">
								<a class="nav-link" href="/">INICIO</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="/somos">SOMOS</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="/tienda">TIENDA</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="/donaciones">DONACIONES</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="/blog">BLOG</a>
							</li>
						</ul>
					</div>
				</div>
			</div>

			<!--Usuario y Carrito-->

			<div class="carrito">
				<div class="bag">
					<a href="/carrito" class="active"><i class="bi bi-bag active"></i></a>
					<div class="span text-center"></div>
				</div>
				<div class="person">
					<a href="/login"><i class="bi bi-person-circle"></i></a>
				</div>
				<div class="logout">
					<c:if test="${ not empty cliente }">
						<a href="/logout">
							<div class="salir">
								<span>Salir</span>
							</div>
						</a>
					</c:if>
				</div>
			</div>
		</nav>

        <!--Carrito-->

		<main>
            <section class="carrito">              
                <p>Carrito de compras</p>
                    <div class="carrito-tabla">
                        <c:choose>
                        <c:when test="${ not empty productos }">
                        <div class="tabla">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Precio</th>
                                        <th>Cantidad</th>
                                        <th>SubTotal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <c:set value="${ 0 }" var="total"></c:set>
                                    <c:set value="${ 0 }" var="cantidad"></c:set>
                                    <c:forEach items="${ productos }" var="p">
                                        <c:set value="${ total + (p.precio * p.cantidad) }" var="total"></c:set>
                                        <c:set value="${ cantidad + p.cantidad }" var="cantidad"></c:set>
                                        <input
                                            type="hidden"
                                            value="${ p.productoId }"
                                            id="productoId">
                                        <tr>
                                            <td id="descripcion">
                                                <img src="${ p.imageUrl[0] }" alt="" height="100" width="100" />
                                                <h6>Descripción</h6>
                                                <div id="icono-eliminar">
                                                    <i class="trash fa-regular fa-trash-can"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#exampleModal"></i>
                                                        <!-- Modal -->
                                                        <div
                                                        class="modal fade"
                                                        id="exampleModal"
                                                        tabindex="-1"
                                                        aria-labelledby="exampleModalLabel"
                                                        aria-hidden="true"
                                                    >
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title" id="exampleModalLabel">
                                                                        Mensaje
                                                                    </h5>
                                                                    <button
                                                                        type="button"
                                                                        class="btn-close"
                                                                        data-bs-dismiss="modal"
                                                                        aria-label="Close"
                                                                    ></button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    Está seguro que desea eliminar el producto de su
                                                                    carrito?
                                                                </div>
                                                                <div class="row">
                                                                    <div class="modal-footer">
                                                                        <div class="col-3">
                                                                            <button
                                                                                type="button"
                                                                                class="button2"
                                                                                data-bs-dismiss="modal"
                                                                            >
                                                                                No
                                                                            </button>
                                                                        </div>
                                                                        <div class="col-3">
                                                                            <button
                                                                                type="button"
                                                                                class="button"
                                                                                onclick="eliminarDelCarrito('${ p.productoId }')"
                                                                            >
                                                                                Si
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td id="format_precio_carrito_${ p.productoId }">${ p.precio }</td>
                                            <td>${ p.cantidad }</td>
                                            <td>${ p.total }</td>
                                        </tr>                                       
                                        <script>
                                            var precio_carrito = $('#format_precio_carrito_${ p.productoId }').html();
                                            console.log(precio_carrito);
                                            var formato_precio = formatter.format(precio_carrito)
                                            $('#format_precio_carrito_${ p.productoId }').html(formato_precio);
                                        </script>
                                    </c:forEach>
                                    <tr id="subtotal">
                                        <td></td>
                                        <td>Subtotal</td>
                                        <td>${ cantidad }</td>
                                        <td id="format_precio_total">${ total }</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <p>Agregar comentarios</p>
                        <div class="textarea-2">
                            <textarea></textarea>
                            <h6>
                                Al hacer clic en “Finalizar compra”, aceptas los términos y condiciones, política de
                                reembolso y privacidad de Retrocicla.
                            </h6>
                        </div>                       									
                            <div><a href="/informacion-usuario"><button class="ppal_btn">Finalizar compra</button>	</a></div>							  
                        </c:when>
                        <c:otherwise>
                            <section class="carrito-2">                              
                                    <div class="loader"></div>
                                    <h1>Usted no tiene elementos en su carrito...</h1>
                                    <h4 id="redirigir" style="font-family: 'Metropolis'; font-size: 18px">
                                        Espera un momento mientras te redireccionamos al inicio...
                                    </h4>
                                    <a href="/">
                                        <h6>Regresar al inicio</h6>
                                    </a>                             
                            </section>
                        </c:otherwise>
                        </c:choose>				
                    </div>              
            </section>
        </main>

		<!-- Footer -->

		<footer>
			<div class="img-horario-contacto">
				<div>
					<img src="img/logo-footer.png" alt="" />
				</div>
				<div>
					<p>HORARIOS</p>
					<p>Lunes a Viernes de 10 a 18 hrs</p>
				</div>

				<div class="contacto">
					<p>CONTÁCTANOS</p>
					<div class="iconos">
						<i class="bi bi-envelope ps-3 pe-3"></i>
						<i class="bi bi-whatsapp pe-3"></i>
						<i class="bi bi-instagram pe-3"></i>
						<i class="bi bi-facebook pe-3"></i>
					</div>
				</div>
			</div>

			<hr />

			<!-- Términos y condiciones -->

			<div class="terminos-y-condiciones">
				<div>
					<p>Copyright retrocicla.cl</p>
				</div>
				<div>
					<a href="/registrar-productos">Registrar productos</a> | <a href="">Términos y condiciones</a> |
					<a href="">Política de reembolso</a> |
					<a href="/politicas-privacidad">Política de privacidad</a>
				</div>
			</div>
		</footer>

		<script src="js/bootstrap.js"></script>
	</body>
</html>
